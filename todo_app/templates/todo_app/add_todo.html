{% extends 'todo_app/base.html' %}

{% block title %}Add New Task{% endblock %}

{% block content %}
<a href="{% url 'todo_list' %}" class="back-link">‚Üê Back to list</a>

<h2 style="color: #333; margin-bottom: 30px;">Add New Task</h2>

<form method="post">
    {% csrf_token %}
    
    <div class="form-group">
        <label for="title">Task Title *</label>
        <input type="text" id="title" name="title" required placeholder="Enter task title...">
    </div>
    
    <div class="form-group">
        <label for="description">Description</label>
        <textarea id="description" name="description" placeholder="Enter task description..."></textarea>
    </div>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
        <div class="form-group">
            <label for="priority">Priority *</label>
            <select id="priority" name="priority" required>
                <option value="low">Low</option>
                <option value="medium" selected>Medium</option>
                <option value="high">High</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="category">Category</label>
            <select id="category" name="category">
                <option value="">No Category</option>
                {% for category in categories %}
                    <option value="{{ category.id }}">{{ category.name }}</option>
                {% endfor %}
            </select>
        </div>
    </div>
    
    <div class="form-group">
        <label for="due_date">Due Date</label>
        <input type="datetime-local" id="due_date" name="due_date">
    </div>
    
    <div class="form-group">
        <label for="notes">Notes</label>
        <textarea id="notes" name="notes" placeholder="Additional notes or details..." rows="4"></textarea>
    </div>
    
    <!-- Subtasks Section -->
    <div class="form-group">
        <label>Subtasks (Optional)</label>
        <div id="subtasks-container">
            <div class="subtask-input" style="display: flex; gap: 10px; margin-bottom: 10px;">
                <input type="text" name="subtask_title[]" placeholder="Subtask title..." style="flex: 1;">
                <button type="button" onclick="removeSubtask(this)" class="btn btn-danger btn-small">Remove</button>
            </div>
        </div>
        <button type="button" onclick="addSubtask()" class="btn btn-small btn-secondary">+ Add Subtask</button>
    </div>
    
    <div style="display: flex; gap: 10px; margin-top: 30px;">
        <button type="submit" class="btn">Add Task</button>
        <a href="{% url 'todo_list' %}" class="btn btn-secondary">Cancel</a>
    </div>
</form>
{% endblock %}

{% block extra_js %}
<script>
function addSubtask() {
    const container = document.getElementById('subtasks-container');
    const newSubtask = document.createElement('div');
    newSubtask.className = 'subtask-input';
    newSubtask.style.cssText = 'display: flex; gap: 10px; margin-bottom: 10px;';
    newSubtask.innerHTML = `
        <input type="text" name="subtask_title[]" placeholder="Subtask title..." style="flex: 1;">
        <button type="button" onclick="removeSubtask(this)" class="btn btn-danger btn-small">Remove</button>
    `;
    container.appendChild(newSubtask);
}

function removeSubtask(button) {
    button.parentElement.remove();
}
</script>
{% endblock %}
